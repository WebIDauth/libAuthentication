============
Introduction
============

libAuthentication is a PHP implementation of the FOAF+SSL protocol
Further details of FOAF+SSL are at http://esw.w3.org/topic/foaf+ssl

============================================================
How to set up Foaf+SSL authentication in a few lines of code
============================================================

There are a few flavours of Foaf+SSL authentication. The following very simple
example shows how to setup a Foaf+SSL authentication relying on an identity provider
such as foaf-ssl.org.

Checkout and Create a script that will be the entry point for your application:

git clone git://github.com/melvincarvalho/libAuthentication.git

cat > index.php
<?php

    require_once('libAuthentication/lib/Authentication.php');
    $auth = new Authentication_FoafSSLDelegate();

if (!$auth->isAuthenticated()) { 

    echo '<a href="https://foafssl.org/srv/idp?authreqissuer=http://localhost/index.php">Click here to Login</a>';

} else { 

    echo 'Your have succesfully logged in.';
    print_r($auth);

} 

Make sure the "authreqissuer" points to YOUR site and...
... YOU ARE DONE!

You just set up you first Foaf+SSL powered site. Behind the scenes,
libAuthentication has a copy of foaf-ssl.org's certificate which is used
in the authentication process.

================================================================================
A more complex setup
================================================================================
If you run your own database that contains Foaf profiles, you can use the
Authentication class that handles all supported authentication methods automatically.

Note:
config.php must be configured with the details of the db you have created for ARC2.
Further details of ARC2 are at http://arc.semsol.org/

You can find the code in examples/authenticationlogin.php

Calling new Authentication() tests if the user has presented a SSL Client Certificate
that matches to public key as expressed in a FOAF file. Authentication can work with
SSL Client Certificates presented to your server or with the FOAF+SSL login
delegation server. To use the delegated FOAF+SSL version ask the user to click on something like 
the following. https://foafssl.org/srv/idp?authreqissuer=http://foaf.me/index.php . In this case 
http://foaf.me/index.php executes new Authentication($config). Alternatively configured your server to request Client
Certificates on the https page the user tries to access. The page needs to execute new Authentication($config).

Authentication stores the result of the user login process in a session so subsequent calls to Authentication's constructor do
not preform any further remote checks on FOAF files. To re-perform the FOAF fetch you need to execute 
$auth->logout().

***WARNING***

Authentication will try to create a session variable therefore it is very
important to execute new Authentication() before any html is sent to the client.
Further details here: http://uk3.php.net/manual/en/book.session.php


==============================================================================
Reference
===============================================================================

For detailed information on libAuthentication classes please refer to the API
documentation.



=============================================================================
THE FOLLOWING DOCUMENTATION IS OUTDATED AND WILL BE REMOVED SOON
==============================================================================
$auth = new Authentication($config);


Returns on Failure
------------------

Array
(
    [isAuthenticated] => 0
    [authDiagnostic] => No client certificate supplied on an unsecure connection
)

Other failure diagnostics are

'authDiagnostic'=>'No client certificate supplied on an unsecure connection'
'authDiagnostic'=>'No client certificate supplied'
'authDiagnostic'=>'No RSA Key in the supplied client certificate'
'authDiagnostic'=>'Client Certificate RSAkey does not match SAN RSAkey'
'authDiagnostic'=>'No RSAKey found at supplied agent'
'authDiagnostic'=>'No agent found at supplied SAN'


Returns on Success
==================

Array
(
    [agent] => Array
        (
            [webid] => http://foaf.me/ah1#me
            [RSAKey] => Array
                (
                    [modulus] => DCB422393132CE6E320A74920E882995CBF56730AFD89A4CADDF212FCFFBF8A23421D03A07EA67437716B6530E9CC9F5099A2E293EAA5220A94EB6D862ED6F5E93EBC7043E5913ED41ECF92A551F12C4FE8A03A53F075FD9B333D31FE89ACAE31C17A8BC74C6089F9979D55CBEBE5EC7110808925A227BF66FF3D8DBB12243B06964CF6EE7AABFDD87B3222257B47C213F7B6000FAD8AA4074DFB00C90A8F35F4A99C0803618429CFABF4A828A48392F657452B31908807C3A276951D5B79E1279A614E3310C748B7A9D23510D753E653932DFD32AEFD5E8E2D59A01D43BEFA2DE1ED0454174F3036E756A3176B58A67C4491126C275DB83F0FDD319C21CC2B3
                    [exponent] => 65537
                )

            [nick] => Array
                (
                    [0] => ah1
                )

            [homepage] => Array
                (
                    [0] => http://foaf.me/ah1
                )

            [knows] => Array
                (
                    [0] => Array
                        (
                            [name] => Melvin Carvalho
                            [about] => http://foaf.me/melvincarvalho#me
                            [webid] => http://foaf.me/melvincarvalho#me
                        )

                    [1] => Array
                        (
                            [name] => Henry Story
                            [about] => http://bblfish.net/people/henry/card#me
                            [webid] => http://bblfish.net/people/henry/card#me
                        )

                )

        )

    [isAuthenticated] => 1
    [authDiagnostic] => Client Certificate RSAkey matches SAN RSAkey
)

--------------------------------------------------------------------------------

unsetAuthenticatedWebID() - Clears the login status of a previous call to getAuth() which has been stored 
			    in a session. By clearing the login status the next call of getAuth() will refetch 
			    the FOAF file presented in the SSL Client Certificate.


---------------------------------------------------------------------------------

get_agent($agenturi) - return details of the FOAF file presented as an array


Usage
-----

$agent = get_agent('http://foaf.me/ah1');

Returns on Failure
------------------

NULL

Returns on Success
------------------

Array
(
    [agent] => Array
        (
            [webid] => http://bblfish.net/people/henry/card#me
            [RSAKey] => Array
                (
                    [modulus] => 862D6E0B8C3252A79D6EB82966F14E495C839EC2D57983EC39BFAC79F8A99F887A3CA559CFEE438E90F73DA143CEFC0A849509D8D91E7093A94C1A39863A5BED78A0F0234A372F12DCE0A9535B14D92D56827B3791352B5817681AD7949AA7831911D51827A57E46BAD9190D73A69CE56ADA74A59DDC0DF2A7A31247BBD67445
                    [exponent] => 65537
                )

            [name] => Henry J. Story
            [mbox] => Array
                (
                    [0] => mailto:henry.story@bblfish.net
                    [1] => mailto:henry.story@gmail.com
                    [2] => mailto:henry.story@sun.com
                )

            [homepage] => Array
                (
                    [0] => http://bblfish.net/
                )

            [nick] => Array
                (
                    [0] => bblfish
                )

            [depiction] => http://farm1.static.flickr.com/164/373663745_e2066a4950.jpg
            [accountProfilePage] => Array
                (
                    [0] => http://www.flickr.com/people/bblfish
                    [1] => http://www.last.fm/user/bblfish
                    [2] => http://delicious.com/bblfish
                    [3] => http://twitter.com/bblfish
                    [4] => http://www.twine.com/user/bblfish
                    [5] => http://www.linkedin.com/pub/0/482/680
                )

            [knows] => Array
                (
                    [0] => Array
                        (
                            [name] => Abraham Bernstein
                            [about] => http://www.ifi.uzh.ch/ddis/fileadmin/user_upload/avi/#me
                            [webid] => http://www.ifi.uzh.ch/ddis/fileadmin/user_upload/avi/#me
                        )

                    [1] => Array
                        (
                            [name] => Andreas Blumauer
                            [about] => http://www.semantic-web.at/people/blumauer/card#me
                            [webid] => http://www.semantic-web.at/people/blumauer/card#me
                        )

                    [2] => Array
                        (
                            [name] => Anja Jentzsch
                            [homepage] => http://www.anjeve.de/
                            [about] => http://www.anjeve.de/foaf.rdf#AnjaJentzsch
                            [webid] => http://www.anjeve.de/foaf.rdf#AnjaJentzsch
                        )

                    [3] => Array
                        (
                            [name] => Archer Phil
                            [about] => http://www.fosi.org/people/philarcher/foaf.rdf#me
                            [webid] => http://www.fosi.org/people/philarcher/foaf.rdf#me
                        )

                    [4] => Array
                        (
                            [name] => Arjohn Kampman
                            [seeAlso] => http://www.openrdf.org/people/foaf-arjohn.rdf
                            [webid] => http://www.openrdf.org/people/foaf-arjohn.rdf
                        )

                    [5] => Array
                        (
                            [name] => Arne Handt
                            [homepage] => http://www.handtwerk.de
                            [about] => http://handtwerk.de/foaf.rdf#arne
                            [webid] => http://handtwerk.de/foaf.rdf#arne
                        )

                    [6] => Array
                        (
                            [name] => Axel Polleres
                            [about] => http://axel.deri.ie/~axepol/foaf.rdf#me
                            [webid] => http://axel.deri.ie/~axepol/foaf.rdf#me
                        )

                    [7] => Array
                        (
                            [name] => Axel Rauschmayer
                            [homepage] => http://www.pst.ifi.lmu.de/people/staff/rauschmayer/axel-rauschmayer/
                            [webid] => http://www.pst.ifi.lmu.de/people/staff/rauschmayer/axel-rauschmayer/
                        )

                    [8] => Array
                        (
                            [name] => Bruno Bonfils
                            [about] => http://foafbuilder.qdos.com/people/asyd.myopenid.com/foaf.rdf#me
                            [webid] => http://foafbuilder.qdos.com/people/asyd.myopenid.com/foaf.rdf#me
                        )

                    [9] => Array
                        (
                            [name] => Cat Bauer
                            [homepage] => http://catbauer.com/
                            [webid] => http://catbauer.com/
                        )

                    [10] => Array
                        (
                            [name] => Chimezie Ogbuji
                            [about] => http://metacognition.info/profile/webwho.xrdf#chime
                            [webid] => http://metacognition.info/profile/webwho.xrdf#chime
                        )

                )

        )

)
